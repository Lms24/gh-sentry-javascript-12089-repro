/*! @sentry/aws-serverless 8.4.0 (3b96745e9) | https://github.com/getsentry/sentry-javascript */
var n=require("./index-GixK7okg.js"),t=require("node:diagnostics_channel");function r(n,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in n)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(n)}var i={},e="object"==typeof globalThis?globalThis:global,o="1.7.0",u=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var f=function(n){var t=new Set([n]),r=new Set,i=n.match(u);if(!i)return function(){return!1};var e=+i[1],o=+i[2],f=+i[3];if(null!=i[4])return function(t){return t===n};function c(n){return r.add(n),!1}function a(n){return t.add(n),!0}return function(n){if(t.has(n))return!0;if(r.has(n))return!1;var i=n.match(u);if(!i)return c(n);var s=+i[1],l=+i[2],h=+i[3];return null!=i[4]||e!==s?c(n):0===e?o===l&&f<=h?a(n):c(n):o<=l?a(n):c(n)}}(o),c=o.split(".")[0],a=Symbol.for("opentelemetry.js.api."+c),s=e;function l(n,t,r,i){var e;void 0===i&&(i=!1);var u=s[a]=null!==(e=s[a])&&void 0!==e?e:{version:o};if(!i&&u[n]){var f=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+n);return r.error(f.stack||f.message),!1}if(u.version!==o){f=new Error("@opentelemetry/api: Registration of version v"+u.version+" for "+n+" does not match previously registered API v"+o);return r.error(f.stack||f.message),!1}return u[n]=t,r.debug("@opentelemetry/api: Registered a global for "+n+" v"+o+"."),!0}function h(n){var t,r,i=null===(t=s[a])||void 0===t?void 0:t.version;if(i&&f(i))return null===(r=s[a])||void 0===r?void 0:r[n]}function v(n,t){t.debug("@opentelemetry/api: Unregistering a global for "+n+" v"+o+".");var r=s[a];r&&delete r[n]}var d,g=function(n,t){var r="function"==typeof Symbol&&n[Symbol.iterator];if(!r)return n;var i,e,o=r.call(n),u=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)u.push(i.value)}catch(n){e={error:n}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return u},y=function(n,t,r){if(r||2===arguments.length)for(var i,e=0,o=t.length;e<o;e++)!i&&e in t||(i||(i=Array.prototype.slice.call(t,0,e)),i[e]=t[e]);return n.concat(i||Array.prototype.slice.call(t))},p=function(){function n(n){this.t=n.namespace||"DiagComponentLogger"}return n.prototype.debug=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return w("debug",this.t,n)},n.prototype.error=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return w("error",this.t,n)},n.prototype.info=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return w("info",this.t,n)},n.prototype.warn=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return w("warn",this.t,n)},n.prototype.verbose=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return w("verbose",this.t,n)},n}();function w(n,t,r){var i=h("diag");if(i)return r.unshift(t),i[n].apply(i,y([],g(r),!1))}!function(n){n[n.NONE=0]="NONE",n[n.ERROR=30]="ERROR",n[n.WARN=50]="WARN",n[n.INFO=60]="INFO",n[n.DEBUG=70]="DEBUG",n[n.VERBOSE=80]="VERBOSE",n[n.ALL=9999]="ALL"}(d||(d={}));var b=function(n,t){var r="function"==typeof Symbol&&n[Symbol.iterator];if(!r)return n;var i,e,o=r.call(n),u=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)u.push(i.value)}catch(n){e={error:n}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return u},m=function(n,t,r){if(r||2===arguments.length)for(var i,e=0,o=t.length;e<o;e++)!i&&e in t||(i||(i=Array.prototype.slice.call(t,0,e)),i[e]=t[e]);return n.concat(i||Array.prototype.slice.call(t))},S=function(){function n(){function n(n){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=h("diag");if(i)return i[n].apply(i,m([],b(t),!1))}}var t=this;t.setLogger=function(n,r){var i,e,o;if(void 0===r&&(r={logLevel:d.INFO}),n===t){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(i=u.stack)&&void 0!==i?i:u.message),!1}"number"==typeof r&&(r={logLevel:r});var f=h("diag"),c=function(n,t){function r(r,i){var e=t[r];return"function"==typeof e&&n>=i?e.bind(t):function(){}}return n<d.NONE?n=d.NONE:n>d.ALL&&(n=d.ALL),t=t||{},{error:r("error",d.ERROR),warn:r("warn",d.WARN),info:r("info",d.INFO),debug:r("debug",d.DEBUG),verbose:r("verbose",d.VERBOSE)}}(null!==(e=r.logLevel)&&void 0!==e?e:d.INFO,n);if(f&&!r.suppressOverrideMessage){var a=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";f.warn("Current logger will be overwritten from "+a),c.warn("Current logger will overwrite one already registered from "+a)}return l("diag",c,t,!0)},t.disable=function(){v("diag",t)},t.createComponentLogger=function(n){return new p(n)},t.verbose=n("verbose"),t.debug=n("debug"),t.info=n("info"),t.warn=n("warn"),t.error=n("error")}return n.instance=function(){return this.i||(this.i=new n),this.i},n}(),_=function(n,t){var r="function"==typeof Symbol&&n[Symbol.iterator];if(!r)return n;var i,e,o=r.call(n),u=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)u.push(i.value)}catch(n){e={error:n}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return u},E=function(n){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&n[t],i=0;if(r)return r.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},O=function(){function n(n){this.o=n?new Map(n):new Map}return n.prototype.getEntry=function(n){var t=this.o.get(n);if(t)return Object.assign({},t)},n.prototype.getAllEntries=function(){return Array.from(this.o.entries()).map((function(n){var t=_(n,2);return[t[0],t[1]]}))},n.prototype.setEntry=function(t,r){var i=new n(this.o);return i.o.set(t,r),i},n.prototype.removeEntry=function(t){var r=new n(this.o);return r.o.delete(t),r},n.prototype.removeEntries=function(){for(var t,r,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var o=new n(this.o);try{for(var u=E(i),f=u.next();!f.done;f=u.next()){var c=f.value;o.o.delete(c)}}catch(n){t={error:n}}finally{try{f&&!f.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return o},n.prototype.clear=function(){return new n},n}(),A=Symbol("BaggageEntryMetadata"),T=S.instance();function N(n){return void 0===n&&(n={}),new O(new Map(Object.entries(n)))}function C(n){return Symbol.for(n)}var R,D,M=function n(t){var r=this;r.u=t?new Map(t):new Map,r.getValue=function(n){return r.u.get(n)},r.setValue=function(t,i){var e=new n(r.u);return e.u.set(t,i),e},r.deleteValue=function(t){var i=new n(r.u);return i.u.delete(t),i}},I=new M,j=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],L=function(){function n(n){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(console){var i=console[n];if("function"!=typeof i&&(i=console.log),"function"==typeof i)return i.apply(console,t)}}}for(var t=0;t<j.length;t++)this[j[t].n]=n(j[t].c)},P=(R=function(n,t){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])},R(n,t)},function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=n}R(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),x=function(){function n(){}return n.prototype.createHistogram=function(n,t){return G},n.prototype.createCounter=function(n,t){return H},n.prototype.createUpDownCounter=function(n,t){return W},n.prototype.createObservableGauge=function(n,t){return Y},n.prototype.createObservableCounter=function(n,t){return X},n.prototype.createObservableUpDownCounter=function(n,t){return J},n.prototype.addBatchObservableCallback=function(n,t){},n.prototype.removeBatchObservableCallback=function(n){},n}(),$=function(){},q=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return P(t,n),t.prototype.add=function(n,t){},t}($),V=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return P(t,n),t.prototype.add=function(n,t){},t}($),k=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return P(t,n),t.prototype.record=function(n,t){},t}($),B=function(){function n(){}return n.prototype.addCallback=function(n){},n.prototype.removeCallback=function(n){},n}(),U=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return P(t,n),t}(B),F=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return P(t,n),t}(B),K=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return P(t,n),t}(B),z=new x,H=new q,G=new k,W=new V,X=new U,Y=new F,J=new K;!function(n){n[n.INT=0]="INT",n[n.DOUBLE=1]="DOUBLE"}(D||(D={}));var Q,Z={get:function(n,t){if(null!=n)return n[t]},keys:function(n){return null==n?[]:Object.keys(n)}},nn={set:function(n,t,r){null!=n&&(n[t]=r)}},tn=function(n,t){var r="function"==typeof Symbol&&n[Symbol.iterator];if(!r)return n;var i,e,o=r.call(n),u=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)u.push(i.value)}catch(n){e={error:n}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return u},rn=function(n,t,r){if(r||2===arguments.length)for(var i,e=0,o=t.length;e<o;e++)!i&&e in t||(i||(i=Array.prototype.slice.call(t,0,e)),i[e]=t[e]);return n.concat(i||Array.prototype.slice.call(t))},en=function(){function n(){}return n.prototype.active=function(){return I},n.prototype.with=function(n,t,r){for(var i=[],e=3;e<arguments.length;e++)i[e-3]=arguments[e];return t.call.apply(t,rn([r],tn(i),!1))},n.prototype.bind=function(n,t){return t},n.prototype.enable=function(){return this},n.prototype.disable=function(){return this},n}(),on=function(n,t){var r="function"==typeof Symbol&&n[Symbol.iterator];if(!r)return n;var i,e,o=r.call(n),u=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)u.push(i.value)}catch(n){e={error:n}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return u},un=function(n,t,r){if(r||2===arguments.length)for(var i,e=0,o=t.length;e<o;e++)!i&&e in t||(i||(i=Array.prototype.slice.call(t,0,e)),i[e]=t[e]);return n.concat(i||Array.prototype.slice.call(t))},fn="context",cn=new en,an=function(){function n(){}return n.getInstance=function(){return this.i||(this.i=new n),this.i},n.prototype.setGlobalContextManager=function(n){return l(fn,n,S.instance())},n.prototype.active=function(){return this.l().active()},n.prototype.with=function(n,t,r){for(var i,e=[],o=3;o<arguments.length;o++)e[o-3]=arguments[o];return(i=this.l()).with.apply(i,un([n,t,r],on(e),!1))},n.prototype.bind=function(n,t){return this.l().bind(n,t)},n.prototype.l=function(){return h(fn)||cn},n.prototype.disable=function(){this.l().disable(),v(fn,S.instance())},n}();!function(n){n[n.NONE=0]="NONE",n[n.SAMPLED=1]="SAMPLED"}(Q||(Q={}));var sn="0000000000000000",ln="00000000000000000000000000000000",hn={traceId:ln,spanId:sn,traceFlags:Q.NONE},vn=function(){function n(n){void 0===n&&(n=hn),this.h=n}return n.prototype.spanContext=function(){return this.h},n.prototype.setAttribute=function(n,t){return this},n.prototype.setAttributes=function(n){return this},n.prototype.addEvent=function(n,t){return this},n.prototype.setStatus=function(n){return this},n.prototype.updateName=function(n){return this},n.prototype.end=function(n){},n.prototype.isRecording=function(){return!1},n.prototype.recordException=function(n,t){},n}(),dn=C("OpenTelemetry Context Key SPAN");function gn(n){return n.getValue(dn)||void 0}function yn(){return gn(an.getInstance().active())}function pn(n,t){return n.setValue(dn,t)}function wn(n){return n.deleteValue(dn)}function bn(n,t){return pn(n,new vn(t))}function mn(n){var t;return null===(t=gn(n))||void 0===t?void 0:t.spanContext()}var Sn=/^([0-9a-f]{32})$/i,_n=/^[0-9a-f]{16}$/i;function En(n){return Sn.test(n)&&n!==ln}function On(n){return _n.test(n)&&n!==sn}function An(n){return En(n.traceId)&&On(n.spanId)}function Tn(n){return new vn(n)}var Nn=an.getInstance(),Cn=function(){function n(){}return n.prototype.startSpan=function(n,t,r){if(void 0===r&&(r=Nn.active()),Boolean(null==t?void 0:t.root))return new vn;var i,e=r&&mn(r);return"object"==typeof(i=e)&&"string"==typeof i.spanId&&"string"==typeof i.traceId&&"number"==typeof i.traceFlags&&An(e)?new vn(e):new vn},n.prototype.startActiveSpan=function(n,t,r,i){var e,o,u;if(!(arguments.length<2)){2===arguments.length?u=t:3===arguments.length?(e=t,u=r):(e=t,o=r,u=i);var f=null!=o?o:Nn.active(),c=this.startSpan(n,e,f),a=pn(f,c);return Nn.with(a,u,void 0,c)}},n}();var Rn,Dn,Mn,In=new Cn,jn=function(){function n(n,t,r,i){this.v=n,this.name=t,this.version=r,this.options=i}return n.prototype.startSpan=function(n,t,r){return this.p().startSpan(n,t,r)},n.prototype.startActiveSpan=function(n,t,r,i){var e=this.p();return Reflect.apply(e.startActiveSpan,e,arguments)},n.prototype.p=function(){if(this.m)return this.m;var n=this.v.getDelegateTracer(this.name,this.version,this.options);return n?(this.m=n,this.m):In},n}(),Ln=new(function(){function n(){}return n.prototype.getTracer=function(n,t,r){return new Cn},n}()),Pn=function(){function n(){}return n.prototype.getTracer=function(n,t,r){var i;return null!==(i=this.getDelegateTracer(n,t,r))&&void 0!==i?i:new jn(this,n,t,r)},n.prototype.getDelegate=function(){var n;return null!==(n=this.m)&&void 0!==n?n:Ln},n.prototype.setDelegate=function(n){this.m=n},n.prototype.getDelegateTracer=function(n,t,r){var i;return null===(i=this.m)||void 0===i?void 0:i.getTracer(n,t,r)},n}();!function(n){n[n.NOT_RECORD=0]="NOT_RECORD",n[n.RECORD=1]="RECORD",n[n.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Rn||(Rn={})),function(n){n[n.INTERNAL=0]="INTERNAL",n[n.SERVER=1]="SERVER",n[n.CLIENT=2]="CLIENT",n[n.PRODUCER=3]="PRODUCER",n[n.CONSUMER=4]="CONSUMER"}(Dn||(Dn={})),function(n){n[n.UNSET=0]="UNSET",n[n.OK=1]="OK",n[n.ERROR=2]="ERROR"}(Mn||(Mn={}));var xn="[_0-9a-z-*/]",$n=new RegExp("^(?:"+("[a-z]"+xn+"{0,255}")+"|"+("[a-z0-9]"+xn+"{0,240}@[a-z]"+xn+"{0,13}")+")$"),qn=/^[ -~]{0,255}[!-~]$/,Vn=/,|=/;var kn=function(){function n(n){this.S=new Map,n&&this._(n)}return n.prototype.set=function(n,t){var r=this.O();return r.S.has(n)&&r.S.delete(n),r.S.set(n,t),r},n.prototype.unset=function(n){var t=this.O();return t.S.delete(n),t},n.prototype.get=function(n){return this.S.get(n)},n.prototype.serialize=function(){var n=this;return this.A().reduce((function(t,r){return t.push(r+"="+n.get(r)),t}),[]).join(",")},n.prototype._=function(n){n.length>512||(this.S=n.split(",").reverse().reduce((function(n,t){var r=t.trim(),i=r.indexOf("=");if(-1!==i){var e=r.slice(0,i),o=r.slice(i+1,t.length);(function(n){return $n.test(n)})(e)&&function(n){return qn.test(n)&&!Vn.test(n)}(o)&&n.set(e,o)}return n}),new Map),this.S.size>32&&(this.S=new Map(Array.from(this.S.entries()).reverse().slice(0,32))))},n.prototype.A=function(){return Array.from(this.S.keys()).reverse()},n.prototype.O=function(){var t=new n;return t.S=new Map(this.S),t},n}();var Bn=an.getInstance(),Un=S.instance(),Fn=new(function(){function n(){}return n.prototype.getMeter=function(n,t,r){return z},n}()),Kn="metrics",zn=function(){function n(){}return n.getInstance=function(){return this.i||(this.i=new n),this.i},n.prototype.setGlobalMeterProvider=function(n){return l(Kn,n,S.instance())},n.prototype.getMeterProvider=function(){return h(Kn)||Fn},n.prototype.getMeter=function(n,t,r){return this.getMeterProvider().getMeter(n,t,r)},n.prototype.disable=function(){v(Kn,S.instance())},n}().getInstance(),Hn=function(){function n(){}return n.prototype.inject=function(n,t){},n.prototype.extract=function(n,t){return n},n.prototype.fields=function(){return[]},n}(),Gn=C("OpenTelemetry Baggage Key");function Wn(n){return n.getValue(Gn)||void 0}function Xn(){return Wn(an.getInstance().active())}function Yn(n,t){return n.setValue(Gn,t)}function Jn(n){return n.deleteValue(Gn)}var Qn="propagation",Zn=new Hn,nt=function(){function n(){this.createBaggage=N,this.getBaggage=Wn,this.getActiveBaggage=Xn,this.setBaggage=Yn,this.deleteBaggage=Jn}return n.getInstance=function(){return this.i||(this.i=new n),this.i},n.prototype.setGlobalPropagator=function(n){return l(Qn,n,S.instance())},n.prototype.inject=function(n,t,r){return void 0===r&&(r=nn),this.T().inject(n,t,r)},n.prototype.extract=function(n,t,r){return void 0===r&&(r=Z),this.T().extract(n,t,r)},n.prototype.fields=function(){return this.T().fields()},n.prototype.disable=function(){v(Qn,S.instance())},n.prototype.T=function(){return h(Qn)||Zn},n}(),tt=nt.getInstance(),rt="trace",it=function(){function n(){this.N=new Pn,this.wrapSpanContext=Tn,this.isSpanContextValid=An,this.deleteSpan=wn,this.getSpan=gn,this.getActiveSpan=yn,this.getSpanContext=mn,this.setSpan=pn,this.setSpanContext=bn}return n.getInstance=function(){return this.i||(this.i=new n),this.i},n.prototype.setGlobalTracerProvider=function(n){var t=l(rt,this.N,S.instance());return t&&this.N.setDelegate(n),t},n.prototype.getTracerProvider=function(){return h(rt)||this.N},n.prototype.getTracer=function(n,t){return this.getTracerProvider().getTracer(n,t)},n.prototype.disable=function(){v(rt,S.instance()),this.N=new Pn},n}().getInstance(),et={context:Bn,diag:Un,metrics:zn,propagation:tt,trace:it},ot=Object.freeze({__proto__:null,DiagConsoleLogger:L,get DiagLogLevel(){return d},INVALID_SPANID:sn,INVALID_SPAN_CONTEXT:hn,INVALID_TRACEID:ln,ProxyTracer:jn,ProxyTracerProvider:Pn,ROOT_CONTEXT:I,get SamplingDecision(){return Rn},get SpanKind(){return Dn},get SpanStatusCode(){return Mn},get TraceFlags(){return Q},get ValueType(){return D},baggageEntryMetadataFromString:function(n){return"string"!=typeof n&&(T.error("Cannot create baggage metadata from unknown type: "+typeof n),n=""),{__TYPE__:A,toString:function(){return n}}},context:Bn,createContextKey:C,createNoopMeter:function(){return z},createTraceState:function(n){return new kn(n)},default:et,defaultTextMapGetter:Z,defaultTextMapSetter:nn,diag:Un,isSpanContextValid:An,isValidSpanId:On,isValidTraceId:En,metrics:zn,propagation:tt,trace:it}),ut=n.getAugmentedNamespace(ot);var ft=n.commonjsGlobal&&n.commonjsGlobal.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(i,"__esModule",{value:!0});var ct=i.FetchInstrumentation=void 0;const at=ft(t),st=n.require$$1,lt=ut;function ht(n){return n instanceof AggregateError?n.errors.map((n=>n.message)).join(", "):n.message}class vt{__init(){this.spanFromReq=new WeakMap}__init2(){this.instrumentationName="opentelemetry-instrumentation-node-18-fetch"}__init3(){this.instrumentationVersion="1.0.0"}__init4(){this.instrumentationDescription="Instrumentation for Node 18 fetch via diagnostics_channel"}subscribeToChannel(n,t){const r=at.default.channel(n);r.subscribe(t),this.channelSubs.push({name:n,channel:r,onMessage:t})}constructor(n){vt.prototype.__init.call(this),vt.prototype.__init2.call(this),vt.prototype.__init3.call(this),vt.prototype.__init4.call(this),fetch("").catch((()=>{})),this.channelSubs=[],this.meter=lt.metrics.getMeter(this.instrumentationName,this.instrumentationVersion),this.tracer=lt.trace.getTracer(this.instrumentationName,this.instrumentationVersion),this.config={...n}}disable(){!function(n){let t,r=n[0],i=1;for(;i<n.length;){const e=n[i],o=n[i+1];if(i+=2,("optionalAccess"===e||"optionalCall"===e)&&null==r)return;"access"===e||"optionalAccess"===e?(t=r,r=o(r)):"call"!==e&&"optionalCall"!==e||(r=o(((...n)=>r.call(t,...n))),t=void 0)}}([this,"access",n=>n.channelSubs,"optionalAccess",n=>n.forEach,"call",n=>n((n=>n.channel.unsubscribe(n.onMessage)))])}enable(){this.subscribeToChannel("undici:request:create",(n=>this.onRequest(n))),this.subscribeToChannel("undici:request:headers",(n=>this.onHeaders(n))),this.subscribeToChannel("undici:request:trailers",(n=>this.onDone(n))),this.subscribeToChannel("undici:request:error",(n=>this.onError(n)))}setTracerProvider(n){this.tracer=n.getTracer(this.instrumentationName,this.instrumentationVersion)}setMeterProvider(n){this.meter=n.getMeter(this.instrumentationName,this.instrumentationVersion)}setConfig(n){this.config={...n}}getConfig(){return this.config}onRequest({request:n}){if("CONNECT"===n.method)return;if(this.config.ignoreRequestHook&&!0===this.config.ignoreRequestHook(n))return;const t=this.tracer.startSpan(`HTTP ${n.method}`,{kind:lt.SpanKind.CLIENT,attributes:{[st.SemanticAttributes.HTTP_URL]:dt(n.origin,n.path),[st.SemanticAttributes.HTTP_METHOD]:n.method,[st.SemanticAttributes.HTTP_TARGET]:n.path,"http.client":"fetch"}}),r=lt.trace.setSpan(lt.context.active(),t),i={};lt.propagation.inject(r,i),this.config.onRequest&&this.config.onRequest({request:n,span:t,additionalHeaders:i}),Array.isArray(n.headers)?n.headers.push(...Object.entries(i).flat()):n.headers+=Object.entries(i).map((([n,t])=>`${n}: ${t}\r\n`)).join(""),this.spanFromReq.set(n,t)}onHeaders({request:n,response:t}){const r=this.spanFromReq.get(n);if(void 0!==r){const n=function(n){const t="content-length";for(let r=0;r<n.length;r+=2){const i=n[r];if(14===i.length&&i.toString().toLowerCase()===t){const t=Number(n[r+1]);return Number.isNaN(Number(t))?void 0:t}}}(t.headers),i={[st.SemanticAttributes.HTTP_STATUS_CODE]:t.statusCode};n&&(i[st.SemanticAttributes.HTTP_RESPONSE_CONTENT_LENGTH]=n),r.setAttributes(i),r.setStatus({code:t.statusCode>=400?lt.SpanStatusCode.ERROR:lt.SpanStatusCode.OK,message:String(t.statusCode)})}}onDone({request:n}){const t=this.spanFromReq.get(n);void 0!==t&&(t.end(),this.spanFromReq.delete(n))}onError({request:n,error:t}){const r=this.spanFromReq.get(n);void 0!==r&&(r.recordException(t),r.setStatus({code:lt.SpanStatusCode.ERROR,message:ht(t)}),r.end())}}function dt(n,t="/"){const r=`${n}`;return n.endsWith("/")&&t.startsWith("/")?`${r}${t.slice(1)}`:n.endsWith("/")||t.startsWith("/")?`${r}${t}`:`${r}/${t.slice(1)}`}ct=i.FetchInstrumentation=vt;var gt=r({__proto__:null,get FetchInstrumentation(){return ct},default:i},[i]);exports.index=gt;
